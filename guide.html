<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Catime 指南 - 了解最新的时间管理技巧、软件更新和用户故事。">
    <title>指南 - Catime | 可爱风 Windows 计时器 & 番茄钟</title>

    <!-- Google 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- AOS 库 -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Marked.js 用于解析Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 自定义样式表 -->
    <link rel="stylesheet" href="style.css">

    <link rel="icon" type="image/png" href="assets/catime.png">
</head>
<body>

    <!-- 页头/导航 -->
    <header class="main-header">
        <nav class="container">
            <a href="index.html" class="logo"><img src="assets/catime.png" class="logo-img" alt="Catime Logo"> Catime</a>
            <ul class="nav-links">
                <li><a href="index.html">首页</a></li>
                <li><a href="guide.html" class="active">指南</a></li>
                <li><a href="https://mp.weixin.qq.com/s/cE6AcVwx4-HPSFM7RBpxmw" target="_blank" rel="noopener noreferrer">关于</a></li>
                <li><a href="https://github.com/vladelaina/Catime" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                <li><a href="https://github.com/vladelaina/Catime/releases/latest" class="nav-button" target="_blank" rel="noopener noreferrer"><i class="fas fa-download"></i> 下载</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- 指南页面标题 -->
        <section class="page-header">
            <div class="container">
                <h1 data-aos="fade-up">Catime 使用指南</h1>
                <p data-aos="fade-up" data-aos-delay="100">了解 Catime 的使用方法、功能特性与常见问题解答</p>
            </div>
        </section>

        <!-- Wiki 内容区域 -->
        <section class="wiki-section">
            <div class="container">
                <div class="wiki-container" data-aos="fade-up">
                    <!-- 左侧导航 -->
                    <div class="wiki-sidebar">
                        <h3>文档目录</h3>
                        <ul class="wiki-list" id="wiki-navigation">
                            <li><a href="#" data-page="Home" class="active">首页</a></li>
                            <li><a href="#" data-page="使用场景">使用场景</a></li>
                            <li class="category">菜单说明</li>
                            <li class="sub-item"><a href="#" data-page="右键托盘图标">右键托盘图标</a></li>
                            <li class="sub-item"><a href="#" data-page="左键托盘图标">左键托盘图标</a></li>
                            <li><a href="#" data-page="常见问题">常见问题</a></li>
                        </ul>
                    </div>
                    
                    <!-- 右侧内容 -->
                    <div class="wiki-content">
                        <div id="wiki-content-container">
                            <div id="content-loading" style="display: none;">
                                <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                            </div>
                            <div id="debug-info" style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px; font-size: 0.9em; display: none;">
                                <div><strong>当前页面URL:</strong> <span id="current-url"></span></div>
                                <div><strong>当前工作目录:</strong> <span id="current-dir"></span></div>
                                <div style="margin-top: 10px;">
                                    <button id="test-fetch" class="btn btn-sm btn-primary">测试加载Home.md</button>
                                    <button id="toggle-debug" class="btn btn-sm btn-secondary" style="margin-left: 10px;">隐藏调试信息</button>
                                </div>
                            </div>
                            <div id="markdown-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2024 Catime Project by <a href="https://github.com/vladelaina" target="_blank" rel="noopener noreferrer">vladelaina</a>.</p>
            <p>基于 <a href="https://github.com/vladelaina/Catime/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">Apache 2.0</a> 许可开源.</p>
            <p>图标画师: <a href="https://space.bilibili.com/26087398" target="_blank" rel="noopener noreferrer">猫屋敷梨梨Official</a></p>
            <div class="footer-links">
                <a href="https://github.com/vladelaina/Catime/issues" target="_blank" rel="noopener noreferrer">问题反馈</a>
                <!-- <a href="#">用户 Q 群</a> -->
                <!-- <a href="#">Discord</a> -->
            </div>
        </div>
    </footer>

    <!-- AOS 库 JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 800, // 动画持续时间
            once: true, // 动画是否只发生一次 - 在向下滚动时
            offset: 50, // 从原始触发点偏移的距离 (以像素为单位)
        });
        
        // Wiki 内容加载
        document.addEventListener('DOMContentLoaded', function() {
            const contentContainer = document.getElementById('markdown-content');
            const loadingIndicator = document.getElementById('content-loading');
            const navLinks = document.querySelectorAll('#wiki-navigation a');
            const debugInfo = document.getElementById('debug-info');
            const currentUrlEl = document.getElementById('current-url');
            const currentDirEl = document.getElementById('current-dir');
            const testFetchBtn = document.getElementById('test-fetch');
            const toggleDebugBtn = document.getElementById('toggle-debug');
            
            // 检查是否从文件系统加载
            const isFileProtocol = window.location.protocol === 'file:';
            
            // 显示调试信息
            function showDebugInfo() {
                debugInfo.style.display = 'block';
                currentUrlEl.textContent = window.location.href;
                currentDirEl.textContent = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
                toggleDebugBtn.textContent = '隐藏调试信息';
            }
            
            // 隐藏调试信息
            function hideDebugInfo() {
                debugInfo.style.display = 'none';
                toggleDebugBtn.textContent = '显示调试信息';
            }
            
            // 检查URL参数是否有debug=true
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('debug') === 'true') {
                showDebugInfo();
            }
            
            // 测试按钮点击事件
            if (testFetchBtn) {
                testFetchBtn.addEventListener('click', function() {
                    if (isFileProtocol) {
                        alert("您正在使用file://协议打开文件，浏览器安全限制会阻止直接读取本地文件。\n\n建议的解决方案:\n使用本地服务器运行此页面");
                    } else {
                        fetch('wiki/Home.md')
                            .then(response => {
                                alert(`Home.md 请求状态: ${response.status} ${response.statusText}`);
                                return response.text();
                            })
                            .then(text => {
                                alert(`文件内容长度: ${text.length} 字符, 前50个字符: ${text.substring(0, 50)}...`);
                            })
                            .catch(error => {
                                alert(`请求出错: ${error.message}`);
                            });
                    }
                });
            }
            
            // 切换调试信息显示
            if (toggleDebugBtn) {
                toggleDebugBtn.addEventListener('click', function() {
                    if (debugInfo.style.display === 'none') {
                        showDebugInfo();
                    } else {
                        hideDebugInfo();
                    }
                });
            }
            
            // 加载内容函数
            function loadContent(pageName) {
                // 显示加载中
                contentContainer.style.display = 'none';
                loadingIndicator.style.display = 'flex';
                
                // 构建文件路径 (根据文件命名约定)
                let filePath;
                
                // 处理特殊文件名和常见路径模式
                if (pageName === '左键托盘图标') {
                    filePath = 'wiki/左键.托盘图标.md';
                } else if (pageName.includes('/')) {
                    // 如果是子目录中的文件
                    filePath = `wiki/${pageName}.md`;
                } else {
                    filePath = `wiki/${pageName}.md`;
                }
                
                console.log(`尝试加载文件: ${filePath}`);
                
                // 使用fetch API加载Markdown文件
                fetch(filePath)
                    .then(response => {
                        if (!response.ok) {
                            // 尝试其他可能的文件路径
                            if (response.status === 404) {
                                // 尝试不带.md后缀的路径
                                return fetch(`wiki/${pageName}`);
                            }
                            throw new Error(`HTTP错误 ${response.status}: ${response.statusText}`);
                        }
                        return response.text();
                    })
                    .then(markdownContent => {
                        if (!markdownContent.trim()) {
                            throw new Error('文件内容为空');
                        }
                        
                        // 替换图片路径，使其指向正确的wiki/images目录
                        markdownContent = markdownContent.replace(
                            /!\[(.*?)\]\((\.\/images\/[^)]+)\)/g, 
                            function(match, altText, imgPath) {
                                // 提取图片文件名
                                const imgFileName = imgPath.replace('./images/', '');
                                return `![${altText}](wiki/images/${imgFileName})`;
                            }
                        );
                        
                        // 处理其他的图片格式，如果没有./前缀
                        markdownContent = markdownContent.replace(
                            /!\[(.*?)\]\((images\/[^)]+)\)/g,
                            '![$1](wiki/$2)'
                        );
                        
                        // 使用marked.js渲染Markdown内容
                        contentContainer.innerHTML = marked.parse(markdownContent);
                        
                        // 设置页面标题
                        const firstHeading = contentContainer.querySelector('h1, h2, h3, h4, h5, h6');
                        if (firstHeading) {
                            document.title = `${firstHeading.textContent} - Catime 指南`;
                        }
                        
                        // 隐藏加载中，显示内容
                        loadingIndicator.style.display = 'none';
                        contentContainer.style.display = 'block';
                        
                        // 处理内部链接
                        handleInternalLinks();
                    })
                    .catch(error => {
                        console.error('加载文件出错:', error);
                        contentContainer.innerHTML = `
                            <div style="padding: 20px; text-align: center;">
                                <h1>内容加载错误</h1>
                                <p>无法加载 "${pageName}" 的内容</p>
                                <p style="color: #666; font-size: 0.9em;">错误详情: ${error.message}</p>
                                <div style="margin-top: 20px;">
                                    <p style="margin-bottom: 15px;">
                                        <strong>可能的原因:</strong><br>
                                        ${isFileProtocol ? 
                                          '您正在使用file://协议打开文件，浏览器安全限制会阻止直接读取本地文件。' : 
                                          '无法从服务器获取文件内容。'}
                                    </p>
                                    <p style="margin-bottom: 15px;">
                                        <strong>解决方案:</strong><br>
                                        ${isFileProtocol ? 
                                          '请使用本地服务器（如 http-server、live-server 等）运行此页面' : 
                                          '请检查文件路径和服务器配置是否正确'}
                                    </p>
                                </div>
                                <p style="margin-top: 20px;">
                                    <a href="#" onclick="window.location.search='?debug=true'; return false;" class="btn btn-sm btn-primary">开启调试模式</a>
                                    <a href="#" onclick="document.querySelector('#wiki-navigation a[data-page=\\'Home\\']').click(); return false;" class="btn btn-sm btn-secondary" style="margin-left: 10px;">返回首页</a>
                                </p>
                            </div>
                        `;
                        loadingIndicator.style.display = 'none';
                        contentContainer.style.display = 'block';
                    });
            }
            
            // 初始加载首页内容
            loadContent('Home');
            
            // 为导航链接添加点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 移除所有active类
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // 为当前点击的链接添加active类
                    this.classList.add('active');
                    
                    // 获取页面名称并加载内容
                    const pageName = this.getAttribute('data-page');
                    loadContent(pageName);
                });
            });
            
            // 处理内部链接
            function handleInternalLinks() {
                document.querySelectorAll('#markdown-content a').forEach(link => {
                    const href = link.getAttribute('href');
                    
                    // 如果是内部wiki链接
                    if (href && (href.startsWith('./') || !href.includes('://') && !href.startsWith('#'))) {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            
                            // 处理链接格式，获取页面名
                            let targetPage = href.replace(/^\.\//, '');
                            
                            // 去掉.md后缀，如果有的话
                            targetPage = targetPage.replace(/\.md$/, '');
                            
                            // 找到对应的导航项并触发点击
                            const navItem = document.querySelector(`#wiki-navigation a[data-page="${targetPage}"]`);
                            if (navItem) {
                                navItem.click();
                            } else {
                                // 加载没有在导航中列出的页面
                                loadContent(targetPage);
                            }
                        });
                    }
                });
            }
        });
    </script>

</body>
</html> 